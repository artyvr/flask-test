name: Release

on:
    release:
        types: [published]

jobs:
    build:
        name: Build and Deploy
        runs-on: ubuntu-latest
        steps:
          - name: Check
            uses: actions/checkout@v4
          - name: Deploy on server
            uses: appleboy/ssh-action@master
            with:
                host: ${{ secrets.HOST }}
                username: ${{ secrets.USERNAME }}
                password: ${{ secrets.PASSWORD }}
                port: ${{ secrets.PORT }}
                script: rm -R -f /home/art/flask-test
                        cd /home/art/
                        git clone https://github.com/artyvr/flask-test.git
                        cd flask-test/app/
                        docker stop $(docker ps -aq)
                        docker rm $(docker ps -aq)
                        docker rmi $(docker images -q)
                        docker build --tag 'flask-test' .
                        docker run -d -p 80:5000 flask-test